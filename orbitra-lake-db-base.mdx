---
title: base
sidebarTitle: base
---

# `orbitra.lake.db.base`

## Classes

### `BaseDB`


Abstract base class for database operations.

This class defines the interface for database operations such as creating namespaces,
creating tables, retrieving metadata, and performing data operations like overwriting partitions
and deleting data based on partition filters. Subclasses should implement these methods
to provide specific database functionality.


**Methods:**

#### `add_column_to_table`

```python
add_column_to_table(self, namespace: str, table_name: str, column: str, column_type: AllowedColumnTypes) -> bool
```

Add a new column to an existing table.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to add the column to.
- `column`: The name of the new column to add.
- `column_type`: The data type of the new column.

**Returns:**
- True if the column was added successfully.

**Raises:**
- `LakeError`: If the column is invalid, already exists or if the table does not exist.


#### `close`

```python
close(self) -> None
```

Close any open database connections.

This method should be overridden by subclasses that need to clean up resources.
The default implementation does nothing.

#### `create_namespace`

```python
create_namespace(self, namespace: str) -> bool
```

Create a namespace in the database.

**Args:**
- `namespace`: The name of the namespace to create.

**Returns:**
- True if the namespace was created successfully.

**Raises:**
- `LakeError`: If the namespace already exists.


#### `create_table`

```python
create_table(self, namespace: str, table: TableSchema) -> bool
```

Create a table in the specified namespace.

**Args:**
- `namespace`: The namespace where the table should be created.
- `table`: The schema of the table to create.

**Returns:**
- True if the table was created successfully.

**Raises:**
- `LakeError`: If the table already exists or if the namespace does not exist.


#### `delete_data`

```python
delete_data(self, namespace: str, table_name: str, partition_filters: list[PartitionFilter]) -> str
```

Delete data from a table based on partition filters.

This method deletes data from a table based on the provided partition filters.
If no partition filters are provided (empty list), the whole table data will be deleted.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to delete data from.
- `partition_filters`: A list of partition filters to apply for deletion.

**Returns:**
- An operation ID for tracking the delete operation.


#### `get_table_data`

```python
get_table_data(self, namespace: str, table_name: str, scan_filters: list[Filter], limit: Optional[int] = None) -> pd.DataFrame
```

Retrieve data from a table based on scan filters.

This method retrieves data from a table based on the provided scan filters.
If no scan filters are provided (empty list), it retrieves all data from the table.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to retrieve data from.
- `scan_filters`: A list of filters to apply for scanning the data
- `limit`: The maximum number of rows to retrieve, defaults to None for all rows.

**Returns:**
- pd.DataFrame: A DataFrame containing the retrieved data.


#### `get_table_hash_sum`

```python
get_table_hash_sum(self, namespace: str, table_name: str) -> Optional[int]
```

Get the sum of the __orbitra_hash__ column for a table.

This method computes the sum of hash values efficiently without loading
all data into memory when possible.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table.

**Returns:**
- Optional\[int]: The sum of hash values, or None if the table is empty
or the hash column doesn't exist.


#### `get_table_metadata`

```python
get_table_metadata(self, namespace: str, table_name: str) -> TableSchema
```

Retrieve the metadata of a table.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to retrieve metadata for.

**Returns:**
- The schema of the table.

**Raises:**
- `LakeError`: If the table does not exist.


#### `get_table_partition_hash_sums`

```python
get_table_partition_hash_sums(self, namespace: str, table_name: str, partition_columns: list[str], partitions_filter: Optional[list[tuple]] = None) -> Optional[dict[tuple, int]]
```

Get the sum of the __orbitra_hash__ column for table partitions.

This method computes the sum of hash values efficiently without loading
all data into memory when possible.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table.
- `partition_columns`: The partitions to group by when calculating the hashes.
- `partitions_filter`: List of filters to apply to the partitions. Defaults to None.

**Returns:**
- Optional\[dict\[tuple, int]]: A dict or None if the table is empty or the hash column doesn't exist.
The dict key are the partition values and the dict value is the hash or None if the partition is empty.


#### `list_namespaces`

```python
list_namespaces(self) -> list[str]
```

List all namespaces in the database.

**Returns:**
- list\[str]: A list of namespace names.


#### `list_tables`

```python
list_tables(self, namespace: str) -> list[str]
```

List all tables in a specified namespace.

**Args:**
- `namespace`: The namespace to list tables from.

**Returns:**
- list\[str]: A list of table names in the specified namespace.

**Raises:**
- `LakeError`: If the namespace does not exist.


#### `overwrite_data`

```python
overwrite_data(self, namespace: str, table_name: str, data: pd.DataFrame) -> str
```

Overwrite data in a table.

This method overwrites the entire data in a table with the provided DataFrame.
If the table has partition columns, it will raise an error.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to overwrite data in.
- `data`: The DataFrame containing the data to overwrite.

**Returns:**
- An operation ID for tracking the overwrite operation.


#### `overwrite_data_by_custom_columns`

```python
overwrite_data_by_custom_columns(self, namespace: str, table_name: str, custom_columns: list[str], data: pd.DataFrame) -> str
```

Overwrite data into a table by custom columns.

This method overwrites data into a table based on the provided custom columns and data.
It will delete data based on the values in the custom columns and then insert the given data frame.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to overwrite data into.
- `custom_columns`: A list of columns to use as custom columns.
- `data`: The DataFrame containing the data to overwrite.

**Returns:**
- An operation ID for tracking the overwrite operation.


#### `overwrite_partitions_data`

```python
overwrite_partitions_data(self, namespace: str, table_name: str, data: pd.DataFrame) -> str
```

Overwrite partitions data in a table.

This method overwrites the data in a table based on the partition columns present in the DataFrame.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to overwrite data in.
- `data`: The DataFrame containing the data to overwrite, which must include partition columns.

**Returns:**
- An operation ID for tracking the overwrite operation.


#### `refresh_token`

```python
refresh_token(self, token: str) -> None
```

Refresh the authentication token for the database.

**Args:**
- `token`: The new authentication token to set.


#### `remove_column_from_table`

```python
remove_column_from_table(self, namespace: str, table_name: str, column: str) -> bool
```

Remove a column from an existing table.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to remove the column from.
- `column`: The name of the column to remove.

**Returns:**
- True if the column was removed successfully.

**Raises:**
- `LakeError`: If the table or column does not exist or if it is a reserved column.


#### `run_query`

```python
run_query(self, namespace: str, query: str, engine: Literal['local', 'remote'] = 'local') -> pd.DataFrame
```

Run a query using the selected environment as query engine.

**Args:**
- `namespace`: The namespace to run the query in.
- `query`: The query to run.
- `engine`: The engine to use for the query.

**Returns:**
- pd.DataFrame: A DataFrame containing the retrieved data.


#### `set_table_properties`

```python
set_table_properties(self, namespace: str, table_name: str, properties: dict[str, str]) -> bool
```

Set properties on a table.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to set properties on.
- `properties`: The properties to set on the table.

**Returns:**
- True if the properties were set successfully.

**Raises:**
- `LakeError`: If the table does not exist.


#### `update_column_type`

```python
update_column_type(self, namespace: str, table_name: str, column: str, column_type: AllowedColumnTypes) -> bool
```

Update the type of a column in an existing table.

**Args:**
- `namespace`: The namespace where the table is located.
- `table_name`: The name of the table to update the column type in.
- `column`: The name of the column to update the type of.
- `column_type`: The new type of the column.

**Returns:**
- True if the column type was updated successfully.

**Raises:**
- `LakeError`: If the table or column does not exist or if it is a reserved column or if the column type is invalid.


